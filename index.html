<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura de Personaje - Cuaderno de Escritura</title>
    <!-- Carga de librerías esenciales -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide React UMD Build -->
    <script src="https://unpkg.com/lucide-react@0.344.0/dist/umd/lucide-react.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Playfair+Display:ital,wght@0,900;1,900&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: #fdfbfc; 
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-sans { font-family: 'Inter', sans-serif; }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-page { animation: fadeIn 0.6s ease-out forwards; }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: white !important; padding: 0; }
            .no-print { display: none !important; }
            .print-margin { padding-left: 95px !important; } /* Margen para bibliorato */
            input, textarea { border-bottom: 1px solid #333 !important; color: black !important; background: transparent !important; }
            .shadow-custom { box-shadow: none !important; }
            .min-h-paper { min-height: auto !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Acceso a los componentes de Lucide desde el espacio de nombres global
        const { 
            User, Heart, Eye, Users, TrendingUp, BookOpen, 
            Printer, Save, ChevronLeft, ChevronRight, 
            CheckCircle, Info, Sparkles, Image: ImageIcon, 
            Volume2, Loader2 
        } = window.Lucide;

        const apiKey = ""; // La plataforma inyecta la clave automáticamente

        // Helper para llamadas a la API con reintentos y backoff exponencial
        async function fetchGemini(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                } catch (err) {
                    if (i === maxRetries - 1) throw err;
                }
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
        }

        const App = () => {
            const [currentPage, setCurrentPage] = useState(1);
            const [formData, setFormData] = useState({});
            const [showSaveToast, setShowSaveToast] = useState(false);
            const [isGeneratingInspiration, setIsGeneratingInspiration] = useState(false);
            const [isGeneratingImage, setIsGeneratingImage] = useState(false);
            const [isPlayingAudio, setIsPlayingAudio] = useState(false);
            const [aiInspiration, setAiInspiration] = useState("");
            const [generatedImageUrl, setGeneratedImageUrl] = useState(null);

            // Persistencia de datos
            useEffect(() => {
                const saved = localStorage.getItem('cuaderno_escritura_vFinal');
                if (saved) setFormData(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('cuaderno_escritura_vFinal', JSON.stringify(formData));
            }, [formData]);

            const handleInputChange = (id, value) => {
                setFormData(prev => ({ ...prev, [id]: value }));
            };

            const saveManual = () => {
                setShowSaveToast(true);
                setTimeout(() => setShowSaveToast(false), 3000);
            };

            // --- Gemini AI Functions ---
            const generateInspiration = async () => {
                if (!formData.p1_nombre && !formData.p1_logline) return;
                setIsGeneratingInspiration(true);
                try {
                    const prompt = `Eres un consultor literario experto. Analiza este personaje:
                    Nombre: ${formData.p1_nombre || 'Desconocido'}
                    Concepto: ${formData.p1_logline || 'Sin definir'}
                    Herida: ${formData.p1_herida || 'No definida'}
                    
                    Sugiere 3 formas creativas de profundizar su conflicto o enriquecer su "pasado útil" para que sea más tridimensional.`;

                    const result = await fetchGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                systemInstruction: { parts: [{ text: "Responde de forma breve, inspiradora y en español." }] }
                            })
                        }
                    );
                    setAiInspiration(result.candidates?.[0]?.content?.parts?.[0]?.text || "No se pudo generar inspiración.");
                } catch (error) { console.error(error); }
                finally { setIsGeneratingInspiration(false); }
            };

            const generateCharacterPortrait = async () => {
                setIsGeneratingImage(true);
                try {
                    const prompt = `Fictional character portrait. Features: ${formData.p2_rasgo || 'human'}, ${formData.p1_oficio || ''}. Artistic, cinematic lighting, concept art style.`;
                    const result = await fetchGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ instances: { prompt }, parameters: { sampleCount: 1 } })
                        }
                    );
                    if (result.predictions?.[0]?.bytesBase64Encoded) {
                        setGeneratedImageUrl(`data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`);
                    }
                } catch (error) { console.error(error); }
                finally { setIsGeneratingImage(false); }
            };

            const playTTS = async (text) => {
                if (!text || isPlayingAudio) return;
                setIsPlayingAudio(true);
                try {
                    const result = await fetchGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: text }] }],
                                generationConfig: {
                                    responseModalities: ["AUDIO"],
                                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }
                                },
                                model: "gemini-2.5-flash-preview-tts"
                            })
                        }
                    );
                    const pcmData = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    if (pcmData) {
                        const binary = window.atob(pcmData);
                        const bytes = new Uint8Array(binary.length);
                        for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
                        const blob = new Blob([bytes], { type: 'audio/wav' });
                        const audio = new Audio(URL.createObjectURL(blob));
                        audio.onended = () => setIsPlayingAudio(false);
                        audio.play();
                    }
                } catch (error) { 
                    console.error(error); 
                    setIsPlayingAudio(false);
                }
            };

            // --- Componentes Reutilizables ---
            const InputField = ({ id, label, placeholder, multiLine = false, helpText = "" }) => (
                <div className="mb-8 group">
                    <label className="block text-[12px] font-black text-[#4a303a] uppercase tracking-[0.1em] mb-1.5 font-sans leading-tight">
                        {label}
                    </label>
                    {multiLine ? (
                        <textarea 
                            value={formData[id] || ''}
                            onChange={(e) => handleInputChange(id, e.target.value)}
                            className="w-full bg-[#fdfbfc] border-b-2 border-[#e8dfe2] focus:border-[#8b3d54] focus:bg-white focus:outline-none py-3 px-2 text-[15px] text-[#4a303a] transition-all duration-300 min-h-[100px] font-sans leading-relaxed resize-none"
                            placeholder={placeholder}
                        />
                    ) : (
                        <input 
                            type="text"
                            value={formData[id] || ''}
                            onChange={(e) => handleInputChange(id, e.target.value)}
                            className="w-full bg-[#fdfbfc] border-b-2 border-[#e8dfe2] focus:border-[#8b3d54] focus:bg-white focus:outline-none py-2.5 px-2 text-[15px] text-[#4a303a] transition-all duration-300 font-sans"
                            placeholder={placeholder}
                        />
                    )}
                    {helpText && <p className="mt-1.5 text-[11px] text-[#9a8288] italic font-sans flex items-start gap-1.5"><Info size={13} className="mt-0.5 text-[#8b3d54] flex-shrink-0" /> {helpText}</p>}
                </div>
            );

            const CheckboxField = ({ id, label, description }) => (
                <div className="flex items-start gap-4 p-3 rounded-xl hover:bg-[#fff0f3] transition-colors cursor-pointer group">
                    <input 
                        type="checkbox" 
                        checked={!!formData[id]}
                        onChange={(e) => handleInputChange(id, e.target.checked)}
                        className="mt-1 w-5 h-5 rounded border-2 border-[#d6b4bc] text-[#8b3d54] focus:ring-[#8b3d54] cursor-pointer" 
                    />
                    <div>
                        <span className="block text-sm font-bold text-[#4a303a] font-sans uppercase tracking-tight">{label}</span>
                        {description && <span className="text-xs text-[#9a8288] italic font-sans">{description}</span>}
                    </div>
                </div>
            );

            const HolePunchGuides = () => (
                <div className="absolute left-0 top-0 bottom-0 w-20 flex flex-col justify-center items-center gap-[80mm] pointer-events-none opacity-20 print:opacity-40">
                    <div className="w-5 h-5 rounded-full border border-[#d6b4bc] flex items-center justify-center">
                        <div className="w-[1px] h-3 bg-[#d6b4bc] absolute"></div>
                        <div className="w-3 h-[1px] bg-[#d6b4bc] absolute"></div>
                    </div>
                    <div className="w-5 h-5 rounded-full border border-[#d6b4bc] flex items-center justify-center">
                        <div className="w-[1px] h-3 bg-[#d6b4bc] absolute"></div>
                        <div className="w-3 h-[1px] bg-[#d6b4bc] absolute"></div>
                    </div>
                </div>
            );

            const pages = [
                { id: 1, title: "Identidad & Motor", icon: <User size={16} /> },
                { id: 2, title: "Presencia & Voz", icon: <Eye size={16} /> },
                { id: 3, title: "Mapa Social", icon: <Users size={16} /> },
                { id: 4, title: "Dinámicas & Arco", icon: <TrendingUp size={16} /> },
            ];

            return (
                <div className="min-h-screen bg-[#fdfbfc] p-4 md:p-8">
                    {showSaveToast && (
                        <div className="fixed top-8 right-8 z-50 animate-in slide-in-from-right duration-300 flex items-center gap-3 bg-[#4a303a] text-white px-6 py-4 rounded-xl shadow-2xl font-sans text-sm font-bold border-l-4 border-[#8b3d54]">
                            <CheckCircle className="text-[#8b3d54]" size={20} /> ¡Ficha guardada!
                        </div>
                    )}

                    <div className="max-w-5xl mx-auto">
                        <header className="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-6 no-print">
                            <div className="flex items-center gap-5">
                                <div className="w-14 h-14 bg-[#4a303a] rounded-2xl flex items-center justify-center shadow-lg transform -rotate-2">
                                    <BookOpen className="text-[#fdfbfc]" size={32} />
                                </div>
                                <div>
                                    <h1 className="text-4xl font-serif font-black text-[#4a303a] leading-none tracking-tighter uppercase">Arquitectura de Personaje</h1>
                                    <p className="text-[#8b3d54] font-sans text-[11px] mt-2 tracking-[0.2em] uppercase font-black opacity-70">Cuaderno de Escritura Creativa</p>
                                </div>
                            </div>
                            <div className="flex gap-3">
                                <button onClick={saveManual} className="flex items-center gap-2 px-5 py-2.5 bg-white border border-[#e8dfe2] rounded-xl text-sm font-bold text-[#4a303a] hover:bg-[#f3e9eb] transition-all shadow-sm"><Save size={18} /> Guardar</button>
                                <button onClick={() => window.print()} className="flex items-center gap-2 px-5 py-2.5 bg-[#4a303a] text-white rounded-xl text-sm font-bold hover:bg-[#3a252d] transition-all shadow-lg"><Printer size={18} /> Imprimir Hoja</button>
                            </div>
                        </header>

                        <nav className="flex flex-wrap gap-1 mb-0 no-print relative z-10">
                            {pages.map((p) => (
                                <button
                                    key={p.id}
                                    onClick={() => setCurrentPage(p.id)}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-t-xl text-[10px] font-black uppercase tracking-widest transition-all border-t border-x ${
                                        currentPage === p.id 
                                        ? "bg-white text-[#4a303a] border-[#e8dfe2] border-t-2 border-t-[#8b3d54] shadow-[0_-5px_15px_rgba(0,0,0,0.02)]" 
                                        : "text-[#9a8288] hover:text-[#4a303a] bg-[#fdfbfc]/50 border-transparent"
                                    }`}
                                >
                                    {p.icon} {p.title}
                                </button>
                            ))}
                        </nav>

                        <div className="bg-white shadow-[0_20px_50px_rgba(74,48,58,0.08)] border border-[#e8dfe2] p-10 md:p-16 md:pl-28 relative min-h-[1120px] print-margin min-h-paper">
                            <HolePunchGuides />

                            {/* PÁGINA 1: IDENTIDAD & MOTOR */}
                            {currentPage === 1 && (
                                <div className="animate-page">
                                    <div className="flex items-center gap-4 mb-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">Identidad y Concepto</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                        <InputField id="p1_nombre" label="Nombre completo" />
                                        <InputField id="p1_apodos" label="Apodo/s y quién se los dice" />
                                        <InputField id="p1_edad" label="Edad y fecha de nacimiento" />
                                        <InputField id="p1_oficio" label="Ocupación / Oficio" />
                                        <InputField id="p1_rol" label="Rol en la trama" helpText="(Protagonista, Antagonista, Aliado, etc.)" />
                                        <InputField id="p1_arquetipo" label="Arquetipo" helpText="(El rebelde, la cuidadora, el cínico, etc.)" />
                                    </div>
                                    <InputField id="p1_logline" label="Concepto central" helpText='"Es un/a [Adjetivo] que quiere [Objetivo] pero se enfrenta a [Obstáculo]"' multiLine />
                                    <InputField id="p1_contradiccion" label="Contradicción principal" helpText="(Ejemplo: Es un soldado valiente que le teme a la oscuridad)" />
                                    
                                    <div className="flex items-center gap-4 my-10 pt-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">El Motor Interno</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                        <button onClick={generateInspiration} disabled={isGeneratingInspiration} className="no-print flex items-center gap-2 px-4 py-2 bg-[#8b3d54] text-white rounded-lg text-xs font-bold disabled:opacity-50 transition-all hover:bg-[#7a374a]">
                                            {isGeneratingInspiration ? <Loader2 size={12} className="animate-spin" /> : <Sparkles size={12} />} ✨ Inspiración
                                        </button>
                                    </div>
                                    {aiInspiration && <div className="no-print mb-8 p-6 bg-[#fffafa] border-2 border-dashed border-[#d6b4bc] rounded-2xl text-sm italic text-[#4a303a] leading-relaxed">{aiInspiration}</div>}
                                    <InputField id="p1_herida" label="La Herida (El Fantasma)" multiLine helpText="Un evento del pasado que todavía le duele" />
                                    <InputField id="p1_mentira" label="La Mentira que se cuenta" multiLine helpText='¿Qué idea falsa cree para no sufrir? (Ej: "No necesito a nadie")' />
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                        <InputField id="p1_deseo" label="Deseo (Lo que CREE que quiere)" />
                                        <InputField id="p1_necesidad" label="Necesidad (Lo que REALMENTE necesita)" />
                                    </div>
                                    <InputField id="p1_linearoja" label="Línea roja" helpText="¿Qué es lo que juró que NUNCA haría?" />
                                </div>
                            )}

                            {/* PÁGINA 2: PRESENCIA & VOZ */}
                            {currentPage === 2 && (
                                <div className="animate-page">
                                    <div className="flex items-center gap-4 mb-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">Presencia Física</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                        <button onClick={generateCharacterPortrait} disabled={isGeneratingImage} className="no-print flex items-center gap-2 px-4 py-2 bg-[#4a303a] text-white rounded-lg text-xs font-bold disabled:opacity-50 transition-all hover:bg-[#3a252d]">
                                            {isGeneratingImage ? <Loader2 size={12} className="animate-spin" /> : <ImageIcon size={12} />} ✨ Retrato IA
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-12 mb-10">
                                        <div className="lg:col-span-2">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                                <InputField id="p2_rasgo" label="Rasgo físico distintivo" helpText="(Mencionado más de una vez)" />
                                                <InputField id="p2_delatador" label="El 'Delatador'" helpText="(Gesto cuando miente o está nervioso)" />
                                            </div>
                                            <InputField id="p2_movimiento" label="Estilo de movimiento" helpText="¿Es torpe, elegante, ocupa espacio, se encoge?" />
                                        </div>
                                        <div className="flex flex-col items-center">
                                            <div className="w-full aspect-[3/4] border-2 border-dashed border-[#e8dfe2] rounded-3xl bg-[#fdfbfc] flex items-center justify-center overflow-hidden relative group shadow-sm">
                                                {generatedImageUrl ? <img src={generatedImageUrl} className="w-full h-full object-cover" /> : <div className="text-center"><ImageIcon size={24} className="mx-auto mb-2 text-[#d6b4bc]" /><p className="text-[10px] font-black text-[#9a8288] uppercase tracking-widest">Retrato<br/>Generado</p></div>}
                                            </div>
                                        </div>
                                    </div>
                                    <InputField id="p2_objetos" label="Objetos con carga emocional" multiLine helpText="Algo que siempre lleva encima y por qué" />
                                    <div className="bg-[#fdfbfc] p-8 rounded-2xl border border-[#e8dfe2] mt-6 grid grid-cols-1 md:grid-cols-3 gap-8">
                                        <div className="md:col-span-3 mb-2"><h3 className="text-[12px] font-bold text-[#4a303a] uppercase tracking-widest font-sans leading-none">Firma sensorial:</h3></div>
                                        <InputField id="p2_olor" label="¿A qué huele?" />
                                        <InputField id="p2_tacto" label="¿Cómo es su tacto?" />
                                        <InputField id="p2_sonido" label="¿Qué sonido hace al llegar?" />
                                    </div>

                                    <div className="flex items-center gap-4 my-10 pt-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">Voz y Social</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                        <InputField id="p2_tono" label="Tono de voz y ritmo" helpText="(Rápido, susurra, gritón, culto, etc.)" />
                                        <InputField id="p2_muletilla" label="Muletilla o palabra recurrente" />
                                        <InputField id="p2_autoridad" label="Actitud frente a la autoridad" />
                                        <InputField id="p2_humor" label="Sentido del humor" helpText="(Irónico, nulo, infantil, negro)" />
                                    </div>
                                    <div className="mt-10 border-t border-[#e8dfe2] pt-10">
                                        <label className="block text-sm font-bold text-[#4a303a] mb-8 uppercase tracking-widest font-sans">Dos frases típicas que diría:</label>
                                        <div className="space-y-10">
                                            {[1, 2].map(n => (
                                                <div key={n} className="flex gap-6 items-center group">
                                                    <span className="text-[#e8dfe2] font-serif font-black italic text-5xl group-hover:text-[#8b3d54] transition-colors">{n}.</span>
                                                    <input value={formData[`p2_frase${n}`] || ''} onChange={(e) => handleInputChange(`p2_frase${n}`, e.target.value)} className="flex-1 bg-transparent border-b-2 border-[#e8dfe2] py-3 italic text-lg font-serif outline-none text-[#4a303a]" placeholder="«Cita literal del personaje...»" />
                                                    <button onClick={() => playTTS(formData[`p2_frase${n}`])} className="no-print text-[#8b3d54] p-3 hover:bg-[#fff0f3] rounded-full transition-all" title="Escuchar voz ✨"><Volume2 size={24} /></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* PÁGINA 3: MAPA SOCIAL */}
                            {currentPage === 3 && (
                                <div className="animate-page">
                                    <div className="flex items-center gap-4 mb-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">El Mapa Social</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                    </div>
                                    <h3 className="text-xs font-bold text-[#8b3d54] uppercase tracking-[0.2em] mb-8 font-sans">1. Círculos de Pertenencia</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-16">
                                        <CheckboxField id="p3_fam" label="Familia" description="Sólido, roto, ausente, tóxico, etc." />
                                        <CheckboxField id="p3_int" label="Círculo Íntimo" description="Amigos, pareja, o aliados en los que confía" />
                                        <CheckboxField id="p3_fun" label="Círculo Funcional" description="Colegas, jefes, subordinados" />
                                        <CheckboxField id="p3_int_h" label="Círculo de Interés" description="Ideología, hobbies, clubes, religión, etc." />
                                        <div className="md:col-span-2 mt-2">
                                            <CheckboxField id="p3_per" label="Círculos Periféricos" description="Gente con la que se cruza pero no encaja (bajo mundo, alta sociedad, etc.)" />
                                        </div>
                                    </div>
                                    <h3 className="text-xs font-bold text-[#8b3d54] uppercase tracking-[0.2em] mb-8 font-sans">2. Estatus y Poder Social</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                        <InputField id="p3_img" label="Imagen pública" helpText='Función reconocida (Ej: "El bufón", "El líder")' />
                                        <InputField id="p3_auto" label="Autoimagen dentro de la sociedad" helpText="(Ej: Un impostor, una víctima, un líder)" />
                                    </div>
                                    <div className="flex flex-col md:flex-row gap-12 mt-8 items-start">
                                        <div className="flex-1 w-full p-8 bg-[#fdfbfc] rounded-2xl border border-[#e8dfe2] shadow-sm">
                                            <label className="block text-sm font-bold text-[#4a303a] mb-6 uppercase tracking-wider">Nivel de influencia</label>
                                            <div className="flex items-center justify-between gap-1">
                                                <span className="text-[10px] text-[#9a8288] font-bold uppercase">Bajo</span>
                                                {[1,2,3,4,5,6,7,8,9,10].map(n => (
                                                    <button key={n} onClick={() => handleInputChange('p3_influencia', n)} className={`w-9 h-9 rounded-xl border-2 text-xs flex items-center justify-center transition-all ${formData['p3_influencia'] === n ? "bg-[#4a303a] border-[#4a303a] text-white font-bold shadow-lg" : "border-[#e8dfe2] text-[#9a8288] hover:border-[#8b3d54]"}`}>{n}</button>
                                                ))}
                                                <span className="text-[10px] text-[#9a8288] font-bold uppercase">Alto</span>
                                            </div>
                                        </div>
                                        <div className="flex-1 w-full">
                                            <InputField id="p3_inout" label="¿Insider o Outsider?" helpText="(¿Se siente parte o es un observador externo?)" />
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* PÁGINA 4: DINÁMICAS & ARCO */}
                            {currentPage === 4 && (
                                <div className="animate-page">
                                    <div className="flex items-center gap-4 mb-10">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter">Sociograma & Arco</h2>
                                        <div className="h-px flex-1 bg-[#e8dfe2]"></div>
                                    </div>
                                    <div className="mb-16">
                                        <h3 className="text-xs font-bold text-[#8b3d54] uppercase tracking-[0.2em] mb-6 font-sans">3. El Sociograma (Esquema Visual)</h3>
                                        <p className="text-[11px] text-[#9a8288] mb-8 italic font-sans leading-relaxed">Dibuja a tu personaje en el centro. Alrededor, escribe los otros personajes/grupos. Usa flechas para marcar interés o tensión.</p>
                                        <div className="border-2 border-dashed border-[#e8dfe2] rounded-[40px] aspect-[16/9] flex items-center justify-center flex-col bg-[#fdfbfc]/40 relative overflow-hidden group shadow-inner">
                                            <div className="w-52 h-52 rounded-full border-8 border-[#4a303a] bg-white z-10 shadow-2xl flex items-center justify-center">
                                                {/* Espacio limpio para el nombre */}
                                            </div>
                                            <div className="absolute top-10 right-10 text-[10px] font-bold text-[#9a8288] uppercase tracking-widest text-right leading-relaxed opacity-60">Dibuja flechas de<br/>interés / tensión</div>
                                            <div className="absolute bottom-10 flex gap-8 text-[10px] font-bold text-[#4a303a] uppercase tracking-widest bg-white/90 px-8 py-3 rounded-full shadow-sm border border-[#e8dfe2] backdrop-blur-sm">
                                                <span className="flex items-center gap-2"><div className="w-6 h-0.5 bg-[#d6b4bc]"></div> Estable (-)</span>
                                                <span className="flex items-center gap-2"><div className="w-6 h-0.5 border-t-2 border-dashed border-[#e8dfe2]"></div> Incierto (--)</span>
                                                <span className="flex items-center gap-2"><div className="text-[#8b3d54] font-black tracking-tighter text-base -mt-1">~~~</div> zigzag (~~~): Conflicto</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12">
                                        <InputField id="p4_anc" label="El Vínculo de Anclaje" helpText="¿Quién logra calmarlo? ¿Quién es para él?" />
                                        <InputField id="p4_ten" label="El Vínculo de Tensión" helpText="¿A quién detesta? ¿Qué proyecta?" />
                                        <InputField id="p4_pra" label="Ayuda Práctica" helpText="(A quién busca ante problemas de dinero o físicos)" />
                                        <InputField id="p4_pro" label="¿A quién protege el personaje?" />
                                        <InputField id="p4_env" label="¿Qué es lo que más envidia de otro?" />
                                        <InputField id="p4_esp" label="El Vínculo Espejo" helpText="¿Quién representa el camino que no tomó?" />
                                    </div>
                                    <div className="bg-[#4a303a] p-10 rounded-[32px] mt-10 shadow-2xl no-print">
                                        <h3 className="text-xs font-bold text-white uppercase tracking-[0.3em] mb-8 text-center">5. Pez dentro y fuera del agua</h3>
                                        <div className="space-y-6">
                                            <textarea value={formData['p4_com'] || ''} onChange={(e) => handleInputChange('p4_com', e.target.value)} className="w-full bg-[#3a252d] border-b border-[#5d454d] outline-none py-4 px-3 text-white text-[15px] font-sans rounded-t-lg transition-colors focus:border-[#8b3d54]" placeholder="¿En qué grupo se siente más cómodo y por qué?" />
                                            <textarea value={formData['p4_hos'] || ''} onChange={(e) => handleInputChange('p4_hos', e.target.value)} className="w-full bg-[#3a252d] border-b border-[#5d454d] outline-none py-4 px-3 text-white text-[15px] font-sans rounded-t-lg transition-colors focus:border-[#8b3d54]" placeholder="¿Y en qué entorno social no? ¿Qué siente? (Vergüenza, Enojo, etc.)" />
                                        </div>
                                    </div>
                                    <div className="mt-20 pt-10 border-t-2 border-[#e8dfe2]">
                                        <h2 className="text-3xl font-serif font-black text-[#4a303a] uppercase tracking-tighter mb-10">Arco de Transformación</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
                                            <InputField id="p4_a" label="Punto A (Inicio)" multiLine helpText="Estado emocional y social al arrancar" />
                                            <InputField id="p4_det" label="El Detonante" multiLine helpText="Evento que lo obliga a cambiar" />
                                            <InputField id="p4_sac" label="Sacrificio" multiLine helpText="¿Qué debe perder para ganar?" />
                                            <InputField id="p4_b" label="Punto B (Final)" multiLine helpText="Nueva visión del mundo tras la historia" />
                                        </div>
                                    </div>
                                </div>
                            )}

                            <footer className="mt-24 pt-10 border-t-4 border-[#e8dfe2] flex justify-between items-center text-[10px] text-[#9a8288] font-sans font-black uppercase tracking-[0.2em]">
                                <span>Capítulo I: Génesis del Personaje</span>
                                <div className="flex gap-8 no-print">
                                    <button disabled={currentPage === 1} onClick={() => setCurrentPage(p => p - 1)} className="hover:text-[#8b3d54] disabled:opacity-20 transition-all"><ChevronLeft size={16} /></button>
                                    <button disabled={currentPage === 4} onClick={() => setCurrentPage(p => p + 1)} className="hover:text-[#8b3d54] disabled:opacity-20 transition-all"><ChevronRight size={16} /></button>
                                </div>
                                <span>Pág {currentPage} / 4</span>
                            </footer>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
